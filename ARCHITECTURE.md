# ğŸ—ï¸ Architecture de l'Application CRM Staffy

## ğŸ“ Vue d'Ensemble

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     UTILISATEUR                              â”‚
â”‚                    (Navigateur Web)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  APPLICATION NEXT.JS                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Pages (App Router)                                  â”‚   â”‚
â”‚  â”‚  â€¢ /login          â†’ Authentification                â”‚   â”‚
â”‚  â”‚  â€¢ /admin          â†’ Dashboard Administrateur        â”‚   â”‚
â”‚  â”‚  â€¢ /agent          â†’ Dashboard Agent                 â”‚   â”‚
â”‚  â”‚  â€¢ /conseiller     â†’ Dashboard Conseiller            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Composants RÃ©utilisables                            â”‚   â”‚
â”‚  â”‚  â€¢ Navbar          â†’ Navigation + DÃ©connexion        â”‚   â”‚
â”‚  â”‚  â€¢ StatsCard       â†’ Cartes de statistiques          â”‚   â”‚
â”‚  â”‚  â€¢ LeadTable       â†’ Tableau des leads               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  BibliothÃ¨ques (lib/)                                â”‚   â”‚
â”‚  â”‚  â€¢ supabase.ts     â†’ Client Supabase                 â”‚   â”‚
â”‚  â”‚  â€¢ auth.ts         â†’ Fonctions d'authentification    â”‚   â”‚
â”‚  â”‚  â€¢ database.types  â†’ Types TypeScript                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE (Backend)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Authentication                                      â”‚   â”‚
â”‚  â”‚  â€¢ Gestion des sessions                              â”‚   â”‚
â”‚  â”‚  â€¢ JWT Tokens                                        â”‚   â”‚
â”‚  â”‚  â€¢ SÃ©curitÃ©                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PostgreSQL Database                                 â”‚   â”‚
â”‚  â”‚  â€¢ profiles        â†’ Utilisateurs + RÃ´les            â”‚   â”‚
â”‚  â”‚  â€¢ leads           â†’ DonnÃ©es des leads               â”‚   â”‚
â”‚  â”‚  â€¢ activities      â†’ Historique des interactions     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Row Level Security (RLS)                            â”‚   â”‚
â”‚  â”‚  â€¢ 18 Policies de sÃ©curitÃ©                           â”‚   â”‚
â”‚  â”‚  â€¢ Isolation des donnÃ©es par rÃ´le                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flux d'Authentification

```
1. Utilisateur â†’ Page /login
                    â†“
2. Saisie email/password
                    â†“
3. Appel signIn() â†’ Supabase Auth
                    â†“
4. Supabase vÃ©rifie les credentials
                    â†“
5. Retour session + user
                    â†“
6. RÃ©cupÃ©ration du profil (table profiles)
                    â†“
7. VÃ©rification du rÃ´le
                    â†“
8. Redirection selon le rÃ´le:
   â€¢ administrateur â†’ /admin
   â€¢ agent         â†’ /agent
   â€¢ conseiller    â†’ /conseiller
```

## ğŸ” SystÃ¨me de Permissions (RLS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMINISTRATEUR                            â”‚
â”‚  âœ… Voir tous les leads                                      â”‚
â”‚  âœ… CrÃ©er des leads                                          â”‚
â”‚  âœ… Modifier tous les leads                                  â”‚
â”‚  âœ… Supprimer des leads                                      â”‚
â”‚  âœ… Voir tous les utilisateurs                               â”‚
â”‚  âœ… GÃ©rer les utilisateurs                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AGENT                                 â”‚
â”‚  âœ… Voir ses propres leads (agent_id = user.id)              â”‚
â”‚  âœ… CrÃ©er des leads                                          â”‚
â”‚  âœ… Modifier ses propres leads                               â”‚
â”‚  âŒ Supprimer des leads                                      â”‚
â”‚  âŒ Voir les leads des autres agents                         â”‚
â”‚  âŒ GÃ©rer les utilisateurs                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONSEILLER                              â”‚
â”‚  âœ… Voir les leads assignÃ©s (conseiller_id = user.id)        â”‚
â”‚  âŒ CrÃ©er des leads                                          â”‚
â”‚  âœ… Modifier les leads assignÃ©s                              â”‚
â”‚  âŒ Supprimer des leads                                      â”‚
â”‚  âŒ Voir les leads non assignÃ©s                              â”‚
â”‚  âŒ GÃ©rer les utilisateurs                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ModÃ¨le de DonnÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  auth.users (Supabase Auth)                                  â”‚
â”‚  â”œâ”€â”€ id (UUID)                                               â”‚
â”‚  â”œâ”€â”€ email                                                   â”‚
â”‚  â””â”€â”€ encrypted_password                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 1:1
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  profiles                                                    â”‚
â”‚  â”œâ”€â”€ id (UUID) â†’ FK auth.users.id                           â”‚
â”‚  â”œâ”€â”€ email                                                   â”‚
â”‚  â”œâ”€â”€ full_name                                               â”‚
â”‚  â”œâ”€â”€ role (administrateur | agent | conseiller)             â”‚
â”‚  â”œâ”€â”€ created_at                                              â”‚
â”‚  â””â”€â”€ updated_at                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 1:N (agent)
                  â”‚ 1:N (conseiller)
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  leads                                                       â”‚
â”‚  â”œâ”€â”€ id (UUID)                                               â”‚
â”‚  â”œâ”€â”€ nom                                                     â”‚
â”‚  â”œâ”€â”€ prenom                                                  â”‚
â”‚  â”œâ”€â”€ email                                                   â”‚
â”‚  â”œâ”€â”€ telephone                                               â”‚
â”‚  â”œâ”€â”€ entreprise                                              â”‚
â”‚  â”œâ”€â”€ poste                                                   â”‚
â”‚  â”œâ”€â”€ statut (nouveau | contacte | qualifie | ...)           â”‚
â”‚  â”œâ”€â”€ source                                                  â”‚
â”‚  â”œâ”€â”€ budget                                                  â”‚
â”‚  â”œâ”€â”€ notes                                                   â”‚
â”‚  â”œâ”€â”€ agent_id â†’ FK profiles.id                              â”‚
â”‚  â”œâ”€â”€ conseiller_id â†’ FK profiles.id                         â”‚
â”‚  â”œâ”€â”€ created_by â†’ FK profiles.id                            â”‚
â”‚  â”œâ”€â”€ created_at                                              â”‚
â”‚  â””â”€â”€ updated_at                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 1:N
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  activities                                                  â”‚
â”‚  â”œâ”€â”€ id (UUID)                                               â”‚
â”‚  â”œâ”€â”€ lead_id â†’ FK leads.id                                  â”‚
â”‚  â”œâ”€â”€ user_id â†’ FK profiles.id                               â”‚
â”‚  â”œâ”€â”€ type (appel | email | reunion | note)                  â”‚
â”‚  â”œâ”€â”€ description                                             â”‚
â”‚  â”œâ”€â”€ date_activite                                           â”‚
â”‚  â””â”€â”€ created_at                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Cycle de Vie d'un Lead

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NOUVEAU  â”‚ â† Lead crÃ©Ã© par un agent
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTACTE â”‚ â† Premier contact Ã©tabli
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUALIFIE â”‚ â† Lead qualifiÃ©, assignÃ© Ã  un conseiller
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEGOCIE  â”‚ â† En cours de nÃ©gociation
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚  GAGNE  â”‚  â”‚ PERDU â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ SÃ©curitÃ© Multi-Niveaux

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Niveau 1 : Frontend (Next.js)                               â”‚
â”‚  â€¢ VÃ©rification de session                                   â”‚
â”‚  â€¢ Redirection si non authentifiÃ©                            â”‚
â”‚  â€¢ Affichage conditionnel selon le rÃ´le                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Niveau 2 : API Supabase                                     â”‚
â”‚  â€¢ Validation du JWT Token                                   â”‚
â”‚  â€¢ VÃ©rification de l'identitÃ©                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Niveau 3 : Row Level Security (PostgreSQL)                  â”‚
â”‚  â€¢ Policies au niveau de la base de donnÃ©es                  â”‚
â”‚  â€¢ Isolation automatique des donnÃ©es                         â”‚
â”‚  â€¢ Impossible de contourner mÃªme avec l'API                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Stack Technologique

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend                                                    â”‚
â”‚  â”œâ”€â”€ Next.js 14        â†’ Framework React avec App Router    â”‚
â”‚  â”œâ”€â”€ TypeScript        â†’ Typage statique                     â”‚
â”‚  â”œâ”€â”€ Tailwind CSS      â†’ Styles utility-first               â”‚
â”‚  â””â”€â”€ Lucide React      â†’ IcÃ´nes modernes                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (Supabase)                                          â”‚
â”‚  â”œâ”€â”€ PostgreSQL        â†’ Base de donnÃ©es relationnelle      â”‚
â”‚  â”œâ”€â”€ Auth              â†’ Authentification JWT                â”‚
â”‚  â”œâ”€â”€ Row Level Securityâ†’ SÃ©curitÃ© au niveau des lignes      â”‚
â”‚  â””â”€â”€ Realtime          â†’ Mises Ã  jour en temps rÃ©el         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Outils de DÃ©veloppement                                     â”‚
â”‚  â”œâ”€â”€ Node.js           â†’ Runtime JavaScript                  â”‚
â”‚  â”œâ”€â”€ NPM               â†’ Gestionnaire de paquets             â”‚
â”‚  â””â”€â”€ Git               â†’ ContrÃ´le de version                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± Structure des Pages

```
app/
â”œâ”€â”€ page.tsx                    â†’ Redirection automatique
â”‚   â””â”€â”€ VÃ©rifie la session et redirige selon le rÃ´le
â”‚
â”œâ”€â”€ login/
â”‚   â””â”€â”€ page.tsx               â†’ Page de connexion
â”‚       â”œâ”€â”€ Formulaire email/password
â”‚       â”œâ”€â”€ Appel signIn()
â”‚       â””â”€â”€ Redirection aprÃ¨s succÃ¨s
â”‚
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ page.tsx               â†’ Dashboard Administrateur
â”‚       â”œâ”€â”€ Vue sur tous les leads
â”‚       â”œâ”€â”€ Gestion des utilisateurs
â”‚       â”œâ”€â”€ Statistiques globales
â”‚       â””â”€â”€ Actions : CrÃ©er/Modifier/Supprimer
â”‚
â”œâ”€â”€ agent/
â”‚   â””â”€â”€ page.tsx               â†’ Dashboard Agent
â”‚       â”œâ”€â”€ Vue sur ses leads uniquement
â”‚       â”œâ”€â”€ Statistiques personnelles
â”‚       â””â”€â”€ Actions : CrÃ©er/Modifier ses leads
â”‚
â””â”€â”€ conseiller/
    â””â”€â”€ page.tsx               â†’ Dashboard Conseiller
        â”œâ”€â”€ Vue sur leads assignÃ©s
        â”œâ”€â”€ Taux de conversion
        â””â”€â”€ Actions : Modifier ses leads assignÃ©s
```

## ğŸ”„ Flux de DonnÃ©es

```
Composant React
      â†“
   useEffect()
      â†“
supabase.from('leads').select()
      â†“
Supabase vÃ©rifie RLS
      â†“
PostgreSQL exÃ©cute la requÃªte
      â†“
Retour des donnÃ©es filtrÃ©es
      â†“
setState() dans React
      â†“
Re-render du composant
      â†“
Affichage Ã  l'utilisateur
```

## ğŸš€ DÃ©ploiement

```
DÃ©veloppement Local
      â†“
npm run build
      â†“
Test de production (npm run start)
      â†“
DÃ©ploiement sur Vercel/Netlify
      â†“
Configuration des variables d'environnement
      â†“
Application en production
```

---

**ğŸ“– Cette architecture garantit :**
- âœ… SÃ©curitÃ© maximale avec RLS
- âœ… SÃ©paration claire des responsabilitÃ©s
- âœ… ScalabilitÃ© de l'application
- âœ… MaintenabilitÃ© du code
- âœ… Performance optimale
